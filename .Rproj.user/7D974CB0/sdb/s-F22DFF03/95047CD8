{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Retail\"\nauthor: \"Ayodeji Akiwowo\"\ndate: \"31 October 2017\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n## Big Mart Sales\nThe Big Mart Sales Prediction was an online Data Science hackhathon on [Analytics Vidhya](https://datahack.analyticsvidhya.com/contest/black-friday/#data_dictionary). \n\n**Problem Statement**\n\n*A retail company “ABC Private Limited” wants to understand the customer purchase behaviour* *(specifically, purchase amount) against various products of different categories. They have shared* *purchase summary of various customers for selected high volume products from last month.*\n*The data set also contains customer demographics (age, gender, marital status, city_type,* *stay_in_current_city), product details (product_id and product category) and Total purchase_amount from* *last month.*\n*Now, they want to build a model to predict the purchase amount of customer against various products* *which will help them to create personalized offer for customers against different products.*\n\nIn summary, we want to see if we can build a model which will predict amount spent by customers (Purchase Amount) on various products using their purchase history. To achieve this aim, we will follow the standard Datascience lifecyle (see figure 1)\n\n![figure 1](images/crispdm.png)\n\n## Data Understanding\n\n**Data**\n```{r, echo=FALSE, message=FALSE, warning=FALSE}\nVariable <- c(\"User_ID\", \"Product_ID\", \"Gender\", \"Age\", \"Occupation\", \"City_Category\", \"Stay_In_Current_City_Years\", \"Marital_Status\", \"Product_Category_1\", \"Product_Category_2\", \"Product_Category_3\", \"Purchase\")\n\nDefinition <- c(\"User ID\", \"Product ID\", \"Sex of User\", \"Age in bins\", \"Occupation (Masked\", \"Category of the City (A,B,C)\", \"Number of Years stay in current city\", \"Marital Status\", \"Product Category (Masked)\", \"Product may belong to other category also (Masked)\", \"Product may belong to other category also (Masked)\", \"Purchase Amount (Target Variable)\")\n\na <- data.frame(Variable, Definition)\nknitr::kable(a, caption = \"Variables in dataset\")\n```\n\n\nTwo datasets were provided for the hack - the training and test datasets with 12 and 11 variables respectively. The \"Purchase Amount\" is the target variable and is hence missing from the test data. \n\n\n\n```{r, message=FALSE, warning=FALSE, include=FALSE}\nlibrary(tidyverse)\nlibrary(magrittr)\nlibrary(grid)\nlibrary(gridExtra)\n```\n\n\n```{r pressure, echo=FALSE}\ntrain <- read.csv(\"data/train.csv\", stringsAsFactors = FALSE)\ntest <- read.csv(\"data/test.csv\", stringsAsFactors = FALSE)\n```\n\n**Data structure:**\n\n```{r}\nstr(train)\n\nstr(test)\n```\nThe training and test datasets are read into R and stored as train (550068 rows) and test (233599 rows). The summary statistics below show that for the training data, asides from Product Category 2 and Product Category 3, none of the variables have any missing values. The missing product categories is not unexpected as the data dictionary has explained that a product may belong to more than one category. Since Product category 1 has no NA, we may safely assume that the product belongs to category 1 if both categories 2 and 3 are NAs.\n\n\n## Data Preparation\n\nThe Product_ID and USer_ID are interesting features. In many cases, these are usually discarded but in this case, I will keep them till I am sure they are not needed. They have been read in as characters and will be trandformed to factors. The Gender, City_category, Marital_Status, Product Categories and Occupation will also be transformed to factors.\n\nIn addition, the \n\n```{r}\ntrain$User_ID <- as.factor(train$User_ID)\ntest$User_ID <- as.factor(test$User_ID)\n\ntrain$Product_ID <- as.factor(train$Product_ID)\ntest$Product_ID <- as.factor(test$Product_ID)\n\ntrain$Gender <- as.factor(train$Gender)\ntest$Gender <- as.factor(test$Gender)\n\ntrain$City_Category <- as.factor(train$City_Category)\ntest$City_Category <- as.factor(test$City_Category)\n\ntrain$Marital_Status <- as.factor(train$Marital_Status)\ntest$Marital_Status <- as.factor(test$Marital_Status)\n\ntrain$Occupation <- as.factor(train$Occupation)\ntest$Occupation <- as.factor(test$Occupation)\n\ntrain$Product_Category_1 <- as.factor(train$Product_Category_1)\ntest$Product_Category_1 <- as.factor(test$Product_Category_1)\n\ntrain$Product_Category_2 <- as.factor(train$Product_Category_2)\ntest$Product_Category_2 <- as.factor(test$Product_Category_2)\n\ntrain$Product_Category_3 <- as.factor(train$Product_Category_3)\ntest$Product_Category_3 <- as.factor(test$Product_Category_3)\n```\n**Summary statistics:**\n\n```{r}\nsummary(train)\n```\n\n```{r}\nsummary(test)\n```\n**Define Hypotheses**\n\n1. **Product:** The lower the cost of a product, the higher the number of purchases (count).\n\n2. **Gender:** Women spend more on purchases than men\n\n3. **Occupation:** Certain types of occupations (dependent on salary band) will have higher purchases\n\n4. **Age:** The older you are, the less you purchase (count and amount spent)\n\n5. **Stay in current city:** The longer you stay in the city, the more purchases you make\n\n6. **Product Category:** The category a product belongs to determines which Gender will have higher purchase (count)\n\n7. **Product Category:** The category a product belongs to determines which Age band will have higher purchase (count)\n\n### Exploratory Data Analysis\nBefore exploring further, I combined both the train and datasets in order to have a broader view of the dataset. However, I created a new variable \"Source\" which acts as label for the two sets and added a variable Purchase for the test set to allow for rbinding. NAs are assigned to this new variable in the test data.\n\n```{r}\ntrain$source <- \"train\"\ntest$source <- \"test\"\ntest$Purchase <- NA\n```\n\n```{r}\ndf <- rbind(train, test)\n```\n\n```{r}\n\nsummary(df)\n\n```\n\n```{r}\ndf %>% group_by(User_ID) %>%\n  summarize(tot = n(), gend = first(Gender)) %>%\n  arrange(desc(tot)) %>%\n  head(10) %>%\n  ggplot(aes(User_ID, tot, fill = gend)) + geom_bar(stat = \"identity\") +\n  labs(x = \"USER\", y = \"Total number of purchases\", fill = \"Gender\") + \n  ggtitle(\"Number of purchases by each user showing their gender\")\n\n```\n\n\nThe plot above shows the top 10 users in terms of counts for the dataset. User 1001680 has the highest number of purchases (1468). We can also see that from the top 10 purchasers, there are 9 males and 1 female. To have a wider view, we will extend this to the top 20 in the next plot.\n\n\n```{r}\ndf %>% group_by(User_ID) %>%\n  summarize(tot = n(), gend = first(Gender)) %>%\n  arrange(desc(tot)) %>%\n  head(20) %>%\n  ggplot(aes(User_ID, tot, fill = gend)) + geom_bar(alpha = 0.7, stat = \"identity\") +\n  labs(x = \"USER\", y = \"Total number of purchases\", fill = \"Gender\") + \n  ggtitle(\"Number of purchases by each user showing their gender\") +\n  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))\n\n```\n\nAgain, there is just one female user in the top 20. This is somewhat not accepting our second hypothesis of women spending more on shopping than men. To confirm this, let's look at the gender variable in terms of the number of purchases and also in terms of how much was spent on purchases\n\n```{r}\ndf %>% ggplot(aes(Gender)) + geom_bar(alpha = 0.7)\n```\n\n\nIn the first instance, from the dataset, there are more men than women. As this is a selected dataset, it will be difficult to make bold conclusions as we do not know how the data was selected. The next step is to look at the total amount spent by both men and females. Remember that only the \"train\" labeled data have purchase amount linked to them. Hence we will restrict our totals to this section only.\n\n```{r}\np1 <- df %>% filter(source == \"train\") %>%\n  group_by(Gender) %>%\n  summarize(totalPurchases = sum(as.numeric(Purchase), na.rm = TRUE),\n            count = n()) %>%\n  ggplot() + geom_bar(fill = \"blue\", alpha = 0.7, aes(Gender, totalPurchases), stat = \"identity\")\n\np2 <- df %>% filter(source == \"train\") %>%\n  group_by(Gender) %>%\n  summarize(meanPurchases = mean(as.numeric(Purchase), na.rm = TRUE),\n            count = n()) %>%\n  ggplot() + geom_bar(fill = \"blue\", alpha = 0.7, aes(Gender, meanPurchases), stat = \"identity\")\n\n\ngrid.arrange(p1, p2, widths = c(0.5, 0.8))\n```\n\n\nIn terms of the total purchases, there's a significant difference in the amount of money spent by males and females. This is most likely due to the large disparity in the number of men and women purchases in the data. A better way to look at purchases is to view it from an average point of view. In essence, how much does a person spend per visit. This is reflected in the second plot (right) showing the meanPurchases. This shows that although the men still lead in terms of purchases, the difference is not that much from the women. However, this means that our second hypothesis is not accepted.\n\n**Occupation**\nThe variable \"Occupation\" defines the occupation of the customers. The real occupation is masked so we only know they are from group 0 to 20. We do not know what these numbers stand for except that they refer to different occupations. \n\n```{r}\ndf %>% group_by(User_ID) %>%\n  summarize(Occ = first(Occupation)) %>%\n  ggplot(aes(Occ)) + geom_bar() + labs(x = \"Occupation\", y = \"No. of Purchases\", title = \"Number of purchases made based on Occupation\")\n```\n\n\nOccupation 4 has the highest number of purchases followed by Occupation 0 and then 7. This means that people with occupation 4 made the highest number of purchases at the store. On the other hand, people with Occupation 8 made the least number of purchases. How do these purchases compare with sales?\n\n```{r}\ndf %>% filter(source == \"train\") %>%\n  group_by(User_ID) %>%\n  summarize(Occ = first(Occupation), sumOcc = sum(Purchase), count = n()) %>%\n  ggplot(aes(Occ,sumOcc)) + geom_bar(fill = \"blue\", stat = \"identity\")\n```\n\n\nThere are no suprises in terms of the amount spent compared with the number of purchases. Occupation 4 still leads (666244484) followed by Occupation 0 (635406958). This is due to the large differences between the count of purchases. When we take a cursory look at the Occupations with little differences in the counts of purchases, some slight deviations will be noticed. For example, whilst there's not much pronounced difference in the number of purchases made between occupations 15 and 13, the difference is noticeable in the amount of money spent. Also, occupation 13 seems to have made more purchases than occupation 11 but the latter spent more money on purchases than the former.\n\n```{r}\ndf %>% filter(source == \"train\") %>%\n  group_by(User_ID) %>%\n  summarize(Occ = first(Occupation), sumOcc = sum(Purchase), count = n()) %>%\n  ggplot(aes(Occ,sumOcc)) + geom_bar(fill = \"blue\", stat = \"identity\")\n```\n",
    "created" : 1509452323337.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3599512278",
    "id" : "95047CD8",
    "lastKnownWriteTime" : 1509546988,
    "last_content_update" : 1509546988645,
    "path" : "C:/Users/AyodejiAkiwowo/Source/Repos/retail/analysis.Rmd",
    "project_path" : "analysis.Rmd",
    "properties" : {
        "last_setup_crc32" : "8D019589bb338d19",
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}